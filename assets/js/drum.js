!function(w){"use strict";var _={up:function(t){var e=t.dail_w,n=t.dail_h,a=d(e,n),i=s(t);w(i).attr("d","m0,"+(n+t.dail_stroke_width)+"l"+e/2+",-"+n+"l"+e/2+","+n),w(a).find("g").append(i);var r=o("dial up");return w(r).find("div").append(a),r},down:function(t){var e=t.dail_w,n=t.dail_h,a=d(e,n),i=s(t);w(i).attr("d","m0,-"+t.dail_stroke_width+"l"+e/2+","+n+"l"+e/2+",-"+n),w(a).find("g").append(i);var r=o("dial down");return w(r).find("div").append(a),r}};function i(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function d(t,e){var n=w(i("svg"));w(n).attr("width",t),w(n).attr("height",e);var a=w(i("g"));return w(n).append(a),n}function o(t){var e=document.createElement("div");w(e).attr("class",t);var n=document.createElement("div");return w(e).append(n),e}function s(t){var e=w(i("path")),n={fill:"none",stroke:t.dail_stroke_color,"stroke-width":t.dail_stroke_width+"px","stroke-linecap":"butt","stroke-linejoin":"miter","stroke-opacity":"1"};for(var a in n)w(e).attr(a,n[a]);return e}function C(t,e,n){this.index=t,this.dataModel=new function(t,e){this.data=t,this.index=e,this.getText=function(){return this.data[this.index]}}(n.data,e),this.init=function(){this.angle=n.theta*t,this.elem=document.createElement("figure"),w(this.elem).addClass("a"+100*this.angle),w(this.elem).css(n.transformProp,n.rotateFn+"("+-this.angle+"deg) translateZ("+n.radius+"px)"),this.setText()},this.setText=function(){w(this.elem).text(this.dataModel.getText())},this.update=function(t){this.dataModel.index!=t&&(this.dataModel.index=t,this.setText())}}function u(t,e,n){var i=w(t)[0],l=w.extend({panelCount:16,rotateFn:"rotateX",interactive:!0,dail_w:20,dail_h:5,dail_stroke_color:"#999999",dail_stroke_width:1},e||{});if(l.transformProp=n,l.rotation=0,l.distance=0,l.last_angle=0,l.theta=360/l.panelCount,l.initselect=i.selectedIndex,l.transformProp){l.data=[];for(var a=0;a<i.children.length;a++)l.data.push(w(i.children[a]).text());w(t).hide();var r=document.createElement("div");w(r).addClass("drum-wrapper"),l.id?w(r).attr("id",l.id):i.id?w(r).attr("id","drum_"+i.id):w(i).attr("name")&&w(r).attr("id","drum_"+w(i).attr("name")),w(i).after(r);var d=document.createElement("div");w(d).addClass("inner"),w(d).appendTo(r);var o=document.createElement("div");w(o).addClass("container"),w(o).appendTo(d);var s=document.createElement("div");if(w(s).addClass("drum"),w(s).appendTo(o),!0===l.interactive){var u=_.up(l);w(r).append(u);var c=_.down(l);w(r).append(c),w(r).hover(function(){w(this).find(".up").show(),w(this).find(".down").show()},function(){w(this).find(".up").hide(),w(this).find(".down").hide()})}l.radius=Math.round(w(s).height()/2/Math.tan(Math.PI/l.panelCount)),l.mapping=[];var h=0;for(a=0;a<l.panelCount&&l.data.length!=a;a++){var p=h;h>=l.panelCount/2&&(p=l.data.length-(l.panelCount-h)),h++;var f=new C(a,p,l);f.init(),l.mapping.push(f),w(s).append(f.elem)}var m=function(t){var e=(((t=t||l.rotation)+l.theta/2)%360+360)%360;e-=e%l.theta;var n=(l.data.length-1)*l.theta;return n<e?0<t?n:0:e},v=function(){var t=m();for(var e in l.mapping)if(l.mapping[e].angle==t)return l.mapping[e]},g=function(t){for(var e,n=[],a=l.panelCount,i=l.panelCount/2,r=l.data.length,d=t.index,o=t.dataModel.index,s=o-i;s<=o+i-1;s++)(e=s)<0&&(e=r+s),r-1<s&&(e=s-r),n.push(e);var u=n.slice(i-d);n=u.concat(n.slice(0,a-u.length));for(d=0;d<l.mapping.length;d++)l.mapping[d].update(n[d])},x=function(t){w(s).css(l.transformProp,"translateZ(-"+l.radius+"px) "+l.rotateFn+"("+l.rotation+"deg)");var e=v();if(e){var n=e.dataModel,a=i.selectedIndex;i.selectedIndex=n.index,t&&a!=n.index&&l.onChange&&l.onChange(i),e.angle!=l.last_angle&&0<=[0,90,180,270].indexOf(e.angle)&&(l.last_angle=e.angle,g(e))}};this.setIndex=function(t){var e=t-Math.floor(t/l.panelCount)*l.panelCount,n=new C(e,t,l);g(n),l.rotation=e*l.theta,x(!1)}}else this.setIndex=function(t){i.selectedIndex=t};this.setIndex(l.initselect),this.getIndex=function(){return l.transformProp?v().dataModel.index:i.selectedIndex},l.transformProp&&("undefined"!=typeof Hammer&&(l.touch=new Hammer(r,{prevent_default:!0,no_mouseevents:!0}),l.touch.on("dragstart",function(t){l.distance=0}),l.touch.on("drag",function(t){0<=["up","down"].indexOf(t.gesture.direction)&&(l.rotation+=-1*Math.round(t.gesture.deltaY-l.distance),x(!0),l.distance=t.gesture.deltaY)}),l.touch.on("dragend",function(t){l.rotation=m(),x(!0)})),l.interactive&&(w(u).click(function(t){var e=l.rotation+l.theta-1;l.rotation=m(e),x(!0)}),w(c).click(function(t){var e=l.rotation-l.theta+1;l.rotation=m(e),x(!0)})))}var n={getIndex:function(){return!!w(this).data("drum")&&w(this).data("drum").getIndex()},setIndex:function(t){w(this).data("drum")&&w(this).data("drum").setIndex(t)},init:function(t){var e=!1;if(!navigator.userAgent.match(/Trident/i)&&!navigator.userAgent.match(/MSIE/i))for(var n="transform WebkitTransform MozTransform OTransform msTransform".split(" "),a=0;a<n.length;a++)void 0!==document.createElement("div").style[n[a]]&&(e=n[a]);var i=w(this);if(!i.data("drum")){var r=new u(i,t,e);i.data("drum",r)}}};w.fn.drum=function(t){var e=arguments;return this.each(function(){return n[t]?n[t].apply(this,Array.prototype.slice.call(e,1)):"object"!=typeof t&&t?void w.error("Method "+t+" does not exist on jQuery.drum"):n.init.apply(this,e)})}}(jQuery);